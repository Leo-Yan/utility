#!/usr/bin/env python

import os
import os.path
import sys, getopt
import binascii
import struct
import string
import array

class generator(object):

    perf_header = [
        0x46524550, 0x32454c49, 0x00000068, 0x00000000,
        0x00000080, 0x00000000, 0x00000078, 0x00000000,
        0x00000100, 0x00000000, 0x00000178, 0x00000000,
        0x00002568, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00057cfc, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000
    ]

    perf_event_id = [
        0x00000015, 0x00000000, 0x00000016, 0x00000000,
    ]

    perf_header_attr1 = [
        0x00000006, 0x00000070, 0x00000000, 0x00000000,
        0x00000001, 0x00000000, 0x00010003, 0x00000000,
        0x00000004, 0x00000000, 0x00141001, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000068, 0x00000000, 0x00000008, 0x00000000,
    ]

    perf_header_attr1 = [
        0x00000006, 0x00000070, 0x00000000, 0x00000000,
        0x00000001, 0x00000000, 0x00010003, 0x00000000,
        0x00000004, 0x00000000, 0x00141001, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000068, 0x00000000, 0x00000008, 0x00000000,
    ]

    perf_header_attr2 = [
        0x00000001, 0x00000070, 0x00000009, 0x00000000,
        0x00000001, 0x00000000, 0x00010003, 0x00000000,
        0x00000004, 0x00000000, 0x01843361, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000070, 0x00000000, 0x00000008, 0x00000000,
    ]

    perf_auxtrace_info = [
        0x00000046, 0x02680000, 0x00000003, 0x00000000,
        0x00000000, 0x00000000, 0x00000008, 0x00000006,
        0x00000000, 0x00000000, 0x40404040, 0x40404040,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000010, 0x00000000, 0x28000ea1, 0x00000000,
        0x4100f403, 0x00000000, 0x00000488, 0x00000000,
        0x00000000, 0x00000000, 0x000000cc, 0x00000000,
        0x40404040, 0x40404040, 0x00000001, 0x00000000,
        0x00000000, 0x00000000, 0x00000012, 0x00000000,
        0x28000ea1, 0x00000000, 0x4100f403, 0x00000000,
        0x00000488, 0x00000000, 0x00000000, 0x00000000,
        0x000000cc, 0x00000000, 0x40404040, 0x40404040,
        0x00000002, 0x00000000, 0x00000000, 0x00000000,
        0x00000014, 0x00000000, 0x28000ea1, 0x00000000,
        0x4100f403, 0x00000000, 0x00000488, 0x00000000,
        0x00000000, 0x00000000, 0x000000cc, 0x00000000,
        0x40404040, 0x40404040, 0x00000003, 0x00000000,
        0x00000000, 0x00000000, 0x00000016, 0x00000000,
        0x28000ea1, 0x00000000, 0x4100f403, 0x00000000,
        0x00000488, 0x00000000, 0x00000000, 0x00000000,
        0x000000cc, 0x00000000, 0x40404040, 0x40404040,
        0x00000004, 0x00000000, 0x00000000, 0x00000000,
        0x00000018, 0x00000000, 0x28000ea1, 0x00000000,
        0x4100f403, 0x00000000, 0x00000488, 0x00000000,
        0x00000000, 0x00000000, 0x000000cc, 0x00000000,
        0x40404040, 0x40404040, 0x00000005, 0x00000000,
        0x00000000, 0x00000000, 0x0000001a, 0x00000000,
        0x28000ea1, 0x00000000, 0x4100f403, 0x00000000,
        0x00000488, 0x00000000, 0x00000000, 0x00000000,
        0x000000cc, 0x00000000, 0x40404040, 0x40404040,
        0x00000006, 0x00000000, 0x00000000, 0x00000000,
        0x0000001c, 0x00000000, 0x28000ea1, 0x00000000,
        0x4100f403, 0x00000000, 0x00000488, 0x00000000,
        0x00000000, 0x00000000, 0x000000cc, 0x00000000,
        0x40404040, 0x40404040, 0x00000007, 0x00000000,
        0x00000000, 0x00000000, 0x0000001e, 0x00000000,
        0x28000ea1, 0x00000000, 0x4100f403, 0x00000000,
        0x00000488, 0x00000000, 0x00000000, 0x00000000,
        0x000000cc, 0x00000000,
    ]

    perf_kernel_mmap = [
        0x00000001, 0x00500001, 0xffffffff, 0x00000000,
        0x08080000, 0xffff0000, 0xf7f7ffff, 0x0000ffff,
        0x08080000, 0xffff0000, 0x72656b5b, 0x2e6c656e,
        0x6c6c616b, 0x736d7973, 0x65745f5d, 0x00007478,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
    ]

    perf_thread = [
        0x00000003, 0x00280000, 0x0000090c, 0x0000090c,
        0x66726570, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000,
    ]

    perf_threads = [
        0x00000003, 0x00282000, 0x0000090c, 0x0000090c,
        0x696e6170, 0x00000063, 0x0000090c, 0x0000090c,
        #0x6d616e75, 0x00000065, 0x0000090c, 0x0000090c,
        0x00000016, 0x00000000, 0x0000000a, 0x00680002,
        0x0000090c, 0x0000090c, 0x00400000, 0x00000000,
        0x00006000, 0x00000000, 0x00000000, 0x00000000,
        0x000000b3, 0x00000009, 0x00000085, 0x00000000,
        0x00000000, 0x00000000, 0x00000005, 0x00001802,
        0x6e69622f, 0x616e752f, 0x0000656d, 0x00000000,
        0x0000090c, 0x0000090c, 0x00000016, 0x00000000,
        0x0000000a, 0x00800002, 0x0000090c, 0x0000090c,
        0xb77c2000, 0x0000ffff, 0x0002e000, 0x00000000,
        0x00000000, 0x00000000, 0x000000b3, 0x00000009,
        0x00000752, 0x00000000, 0x00000000, 0x00000000,
        0x00000005, 0x00001802, 0x62696c2f, 0x7261612f,
        0x34366863, 0x6e696c2d, 0x672d7875, 0x6c2f756e,
        0x2e322d64, 0x732e3931, 0x0000006f, 0x00000000,
        0x0000090c, 0x0000090c, 0x00000016, 0x00000000,
        0x0000000a, 0x00600002, 0x0000090c, 0x0000090c,
        0xb77ec000, 0x0000ffff, 0x00001000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000005, 0x00001002, 0x7364765b, 0x00005d6f,
        0x0000090c, 0x0000090c, 0x00000016, 0x00000000,
        0x0000000a, 0x00800002, 0x0000090c, 0x0000090c,
        0xb7675000, 0x0000ffff, 0x0014d000, 0x00000000,
        0x00000000, 0x00000000, 0x000000b3, 0x00000009,
        0x0000076a, 0x00000000, 0x00000000, 0x00000000,
        0x00000005, 0x00001002, 0x62696c2f, 0x7261612f,
        0x34366863, 0x6e696c2d, 0x672d7875, 0x6c2f756e,
        0x2d636269, 0x39312e32, 0x006f732e, 0x00000000,
        0x0000090c, 0x0000090c, 0x00000016, 0x00000000,
        0x0000000b, 0x00300000, 0x00000000, 0x00000000,
        0x00002000, 0x00000000, 0x00000001, 0x00000000,
        0x0000090c, 0x0000090c, 0x00000015, 0x00000000,
        0x00000004, 0x00300000, 0x0000090c, 0x0000090c,
        0x0000090c, 0x0000090c, 0xf89cbddc, 0x00000571,
        0x0000090c, 0x0000090c, 0x00000016, 0x00000000,
    ]

    perf_auxtrace_snapshot = [
        0x00000047, 0x00300000, 0x00002000, 0x00000000,
        0x00000000, 0x00000000, 0x74bc6ab4, 0x5a1c47b3,
        0x00000000, 0x0000090c, 0xffffffff, 0x00000000,
    ]

    perf_record_finish = [
        0x00000044, 0x00080000,
    ]

    perf_sections = [
        0x000027e0, 0x00000000, 0x000001f4, 0x00000000,
        0x000029d4, 0x00000000, 0x00000044, 0x00000000,
        0x00002a18, 0x00000000, 0x00000044, 0x00000000,
        0x00002a5c, 0x00000000, 0x00000044, 0x00000000,
        0x00002aa0, 0x00000000, 0x00000044, 0x00000000,
        0x00002ae4, 0x00000000, 0x00000008, 0x00000000,
        0x00002aec, 0x00000000, 0x00000008, 0x00000000,
        0x00002af4, 0x00000000, 0x0000019c, 0x00000000,
        0x00002c90, 0x00000000, 0x00000188, 0x00000000,
        0x00002e18, 0x00000000, 0x000002f0, 0x00000000,
        0x00003108, 0x00000000, 0x0000005c, 0x00000000,
        0x00003164, 0x00000000, 0x000000dc, 0x00000000,
        0x00003240, 0x00000000, 0x00000018, 0x00000000,
        0x00003258, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
    ]

    perf_sections_feat = [
        0x00000000, 0x00640001, 0xffffffff, 0xc9b5ee32,
        0xa6009dc9, 0xcb21093d, 0x23c315d8, 0x1067c385,
        0x00000000, 0x72656b5b, 0x2e6c656e, 0x6c6c616b,
        0x736d7973, 0x0000005d, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00640002, 0xffffffff,
        0x1b4fa8bf, 0x5227cff0, 0x12da0f18, 0x9bdbd314,
        0x02d8f0fd, 0x00000000, 0x6e69622f, 0x616e752f,
        0x0000656d, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00640002,
        0xffffffff, 0xc2fd81b6, 0xa893b4c7, 0x40184f04,
        0xf20fb850, 0xca4e57de, 0x00000000, 0x62696c2f,
        0x7261612f, 0x34366863, 0x6e696c2d, 0x672d7875,
        0x6c2f756e, 0x2e322d64, 0x732e3931, 0x0000006f,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00640002, 0xffffffff, 0x4c2ffe6e, 0x2234c314,
        0x6ae1493d, 0xb900c113, 0x231b0116, 0x00000000,
        0x7364765b, 0x00005d6f, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00640002, 0xffffffff, 0xf6cb9abe,
        0x9193a0ac, 0x8041f9a9, 0xf1fd557a, 0x8bd54983,
        0x00000000, 0x62696c2f, 0x7261612f, 0x34366863,
        0x6e696c2d, 0x672d7875, 0x6c2f756e, 0x2d636269,
        0x39312e32, 0x006f732e, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000040, 0x616e696c, 0x642d6f72,
        0x6c657665, 0x7265706f, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000040, 0x32312e34,
        0x722d302e, 0x302d3363, 0x30323030, 0x6563672d,
        0x35643530, 0x00000032, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000040,
        0x31312e34, 0x3163722e, 0x3866672e, 0x31633032,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000040, 0x63726161, 0x00343668, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000008, 0x00000008, 0x000ce050,
        0x00000000, 0x00000006, 0x00000040, 0x6f6f722f,
        0x65702f74, 0x00006672, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000040,
        0x6f636572, 0x00006472, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000040, 0x0000652d, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000040, 0x655f7363, 0x402f6d74,
        0x30343666, 0x30303032, 0x6674652e, 0x0000002f,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000040, 0x65702d2d,
        0x68742d72, 0x64616572, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000040,
        0x696e6170, 0x00000063, 0x00000000, 0x00000000,
        #0x6d616e75, 0x00000065, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000002, 0x00000070, 0x00000006, 0x00000070,
        0x00000000, 0x00000000, 0x00000001, 0x00000000,
        0x00010003, 0x00000000, 0x00000004, 0x00000000,
        0x00141001, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000001, 0x00000040,
        0x655f7363, 0x402f6d74, 0x30343666, 0x30303032,
        0x6674652e, 0x0000002f, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000015, 0x00000000, 0x00000001, 0x00000070,
        0x00000009, 0x00000000, 0x00000001, 0x00000000,
        0x00010003, 0x00000000, 0x00000004, 0x00000000,
        0x01843361, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000001, 0x00000040,
        0x6d6d7564, 0x00753a79, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000016, 0x00000000, 0x00000002, 0x00000040,
        0x00332d30, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000040, 0x00372d34, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000008, 0x00000040, 0x00000030,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000040,
        0x00000031, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000040, 0x00000032, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000040, 0x00000033, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000040, 0x00000034,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000040,
        0x00000035, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000040, 0x00000036, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000040, 0x00000037, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000001, 0x00000000, 0x00000002, 0x00000000,
        0x00000003, 0x00000000, 0x00000000, 0x00000001,
        0x00000001, 0x00000001, 0x00000002, 0x00000001,
        0x00000003, 0x00000001, 0x00000001, 0x00000000,
        0x000ce050, 0x00000000, 0x000ae82c, 0x00000000,
        0x00000040, 0x00372d30, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000006, 0x00000040,
        0x655f7363, 0x00006d74, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000005, 0x00000040, 0x61657262, 0x696f706b,
        0x0000746e, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000001, 0x00000040,
        0x74666f73, 0x65726177, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000001, 0x00000000, 0x000006a8, 0x00000000,
        0x00000030, 0x00000000,
    ]

    trace_img = ''
    trace_len = 0

    def __init__(self, in_img, out_img):
        try:
            self.fp = open(out_img, "wb+")
        except IOError, e:
            print "*** file open error:", e
            sys.exit(3)
        self.trace_img = in_img

    def __del__(self):
        self.fp.close()

    def fill_header(self):
        data = array.array('I', self.perf_header)
        self.fp.write(data)

        data = array.array('I', self.perf_event_id)
        self.fp.write(data)

        data = array.array('I', self.perf_header_attr1)
        self.fp.write(data)

        data = array.array('I', self.perf_header_attr2)
        self.fp.write(data)

        data = array.array('I', self.perf_auxtrace_info)
        self.fp.write(data)
        self.trace_len += len(data) << 2

        data = array.array('I', self.perf_kernel_mmap)
        self.fp.write(data)
        self.trace_len += len(data) << 2

        data = array.array('I', self.perf_thread)
        self.fp.write(data)
        self.trace_len += len(data) << 2

        data = array.array('I', self.perf_threads)
        self.fp.write(data)
        self.trace_len += len(data) << 2

        data = array.array('I', self.perf_auxtrace_snapshot)
        self.fp.write(data)
        self.trace_len += len(data) << 2

    def fill_trace_data(self):
        f = open(self.trace_img, "rb")
        data = f.read()
        self.fp.write(data)
        self.trace_len += len(data)

        data = array.array('I', self.perf_record_finish)
        self.fp.write(data)
        self.trace_len += len(data) << 2

        data = array.array('I', self.perf_sections)
        self.fp.write(data)

        data = array.array('I', self.perf_sections_feat)
        self.fp.write(data)

    def end(self):
        self.perf_header[12] = self.trace_len
        data = array.array('I', self.perf_header)
        self.fp.seek(0)
        self.fp.write(data)
        self.fp.close()

def main(argv):
    out_img = ''
    in_img  = ''
    try:
        opts, args = getopt.getopt(argv, "hi:o:")
    except getopt.GetoptError:
        print 'perf_cs_dump_wrapper.py -i <cstrace.bin> -o <perf_cs_dump.data> -b <hikey|db410c>'
        sys.exit(2)
    for opt, arg in opts:
        if opt == '-h':
            print 'perf_cs_dump_wrapper.py -i <cstrace.bin> -o <perf_cs_dump.data> -b <hikey|db410c>'
            sys.exit(1)
        elif opt == '-o':
            out_img = arg
        elif opt == '-i':
            in_img = arg

    loader = generator(in_img, out_img)
    loader.fill_header()
    loader.fill_trace_data()
    loader.end()

if __name__ == "__main__":
    main(sys.argv[1:])
